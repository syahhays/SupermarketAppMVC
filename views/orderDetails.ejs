<!DOCTYPE html>
<html>
<head>
  <title>Order <%= orderId %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <%- include('partials/navbar') %>

  <div class="container mt-5">
    <h1>Order Invoice</h1>
    <h4>Order ID: <%= orderId %></h4>

    <table class="table table-striped mt-4">
      <thead class="table-dark">
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>

      <tbody>
        <% items.forEach(i => { %>
          <tr>
            <td><%= i.productName %></td>
            <td><%= i.quantity %></td>
            
            <!-- FIX: MySQL returns price as STRING, convert to number -->
            <td>$<%= Number(i.price).toFixed(2) %></td>

            <!-- FIX: Compute row total safely -->
            <td>$<%= (Number(i.price) * i.quantity).toFixed(2) %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <!-- FIX: Ensure total is number -->
    <h3 class="text-end mt-3">Grand Total: $<%= Number(total).toFixed(2) %></h3>

    <a href="/orders" class="btn btn-secondary mt-3">Back to Order History</a>
  </div>

</body>
</html>