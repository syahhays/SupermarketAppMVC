<!DOCTYPE html>
<html>
<head>
  <title>Order <%= orderId %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <%- include('partials/navbar') %>

  <div class="container mt-5">
    <h1>Order Invoice</h1>
    <h4>Order ID: <%= orderId %></h4>

    <table class="table table-striped mt-4">
      <thead class="table-dark">
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>

      <tbody>
        <% items.forEach(i => { %>
          <tr>
            <td><%= i.productName %></td>
            <td><%= i.quantity %></td>
            
            <!-- FIX: MySQL returns price as STRING, convert to number -->
            <td>$<%= Number(i.price).toFixed(2) %></td>

            <!-- FIX: Compute row total safely -->
            <td>$<%= (Number(i.price) * i.quantity).toFixed(2) %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <div class="d-flex justify-content-end">
      <table class="table table-borderless w-auto">
        <tbody>
          <tr>
            <td class="text-end">Subtotal</td>
            <td class="text-end">$<%= Number(subtotal || 0).toFixed(2) %></td>
          </tr>
          <tr>
            <td class="text-end">Tax</td>
            <td class="text-end">$<%= Number(tax || 0).toFixed(2) %></td>
          </tr>
          <tr>
            <td class="text-end">Shipping</td>
            <td class="text-end">$<%= Number(shipping || 0).toFixed(2) %></td>
          </tr>
          <tr class="border-top">
            <th class="text-end">Grand Total</th>
            <th class="text-end">$<%= Number(total || 0).toFixed(2) %></th>
          </tr>
        </tbody>
      </table>
    </div>

    <a href="/orders" class="btn btn-secondary mt-3">Back to Order History</a>
  </div>

</body>
</html>
