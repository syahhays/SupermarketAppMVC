<!DOCTYPE html>
<html>
<head>
  <title>Your Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <%- include('partials/navbar') %>

  <div class="container mt-5">
    <h1>Your Order History</h1>

    <% if (orders.length === 0) { %>
      <p>You have no previous orders.</p>
    <% } else { %>

      <table class="table table-bordered table-striped mt-4">
        <thead class="table-dark">
          <tr>
            <th>Order ID</th>
            <th>Total Amount</th>
            <th>Date</th>
            <th>Status</th>
            <th>Payment</th>
            <th>View</th>
          </tr>
        </thead>

        <tbody>
          <% orders.forEach(order => { %>
            <tr>
              <td><%= order.id %></td>
              <td>$<%= Number(order.totalAmount || 0).toFixed(2) %></td>
              <td><%= order.orderDate %></td>
              <td>
                <span class="badge <%= order.status === 'REFUNDED' ? 'bg-danger' : (order.status === 'PAID' ? 'bg-success' : 'bg-secondary') %>">
                  <%= order.status %>
                </span>
                <% if (order.refunded_at) { %>
                  <div class="text-muted small">Refunded: <%= order.refunded_at %></div>
                <% } %>
              </td>
              <td>
                <div><%= order.payment_method || order.payment_provider || 'N/A' %></div>
                <% if (order.refund_ref) { %>
                  <div class="text-muted small">Refund ref: <%= String(order.refund_ref).slice(0, 10) %>...</div>
                <% } %>
              </td>
              <td>
                <a href="/orders/<%= order.id %>" class="btn btn-primary btn-sm">Details</a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

    <% } %>
  </div>

</body>
</html>
