<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shopping Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('partials/navbar') %>

  <div class="container">
    <h1 class="mb-4">Your Shopping Cart</h1>

    <% const hasItems = cart && cart.length > 0; %>

    <div class="row">
      <!-- LEFT: Cart Items Table -->
      <div class="col-lg-8 mb-4">
        <% if (hasItems) { %>
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead class="table-dark">
                <tr>
                  <th scope="col">Image</th>
                  <th scope="col">Product</th>
                  <th scope="col">Price ($)</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total ($)</th>
                </tr>
              </thead>
              <tbody>
                <% cart.forEach(item => { 
                     const lineTotal = item.price * item.quantity;
                %>
                  <tr>
                    <td style="width: 80px;">
                      <% if (item.image) { %>
                        <img src="/images/<%= item.image %>" alt="<%= item.productName %>" class="img-fluid" style="max-height: 60px;">
                      <% } else { %>
                        <span class="text-muted">No image</span>
                      <% } %>
                    </td>

                    <td>
                      <strong><%= item.productName %></strong>
                    </td>

                    <td>
                      <%= item.price.toFixed ? item.price.toFixed(2) : item.price %>
                    </td>

                    <!-- Quantity update + Remove -->
                    <td>
                      <form action="/cart/update/<%= item.productId %>" method="POST" class="d-flex mb-1">
                        <input 
                          type="number" 
                          name="quantity" 
                          class="form-control form-control-sm me-2"
                          value="<%= item.quantity %>" 
                          min="1">
                        <button class="btn btn-sm btn-primary">Update</button>
                      </form>

                      <a href="/cart/remove/<%= item.productId %>" 
                         class="btn btn-sm btn-danger">
                        Remove
                      </a>
                    </td>

                    <td>
                      <%= lineTotal.toFixed ? lineTotal.toFixed(2) : lineTotal %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>

        <% } else { %>
          <p class="text-muted">Your cart is empty. Go to the <a href="/shopping">shop</a> to add items.</p>
        <% } %>
      </div>

      <!-- RIGHT: Summary Card -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header bg-dark text-white">
            Cart Summary
          </div>
          <div class="card-body">
            <% if (hasItems) { %>

              <p class="card-text">
                You have <strong><%= cart.length %></strong> item<%= cart.length > 1 ? 's' : '' %> in your cart.
              </p>

              <hr>

              <h5 class="card-title">Grand Total:</h5>
              <h3>
                $<%= grandTotal.toFixed ? grandTotal.toFixed(2) : grandTotal %>
              </h3>

              <a href="/checkout" class="btn btn-success w-100 mt-3">
                Checkout
              </a>

              <a href="/cart/clear" class="btn btn-warning w-100 mt-2">
                Clear Cart
              </a>

            <% } else { %>
              <p class="text-muted">No items in cart.</p>
              <a href="/shopping" class="btn btn-primary w-100">Go to Shop</a>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%- include('partials/footer') %>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>