<!DOCTYPE html>
<html>
<head>
  <title>Refund Requests (Admin)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<%- include('partials/navbar') %>

<div class="container mt-4">
  <h1>Refund Requests</h1>

  <% if (!requests || requests.length === 0) { %>
    <p class="text-muted">No refund requests yet.</p>
  <% } else { %>
    <table class="table table-striped mt-3">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Order</th>
          <th>User</th>
          <th>Amount</th>
          <th>Method</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% requests.forEach(r => { %>
          <tr>
            <td><%= r.id %></td>
            <td>#<%= r.order_id %></td>
            <td><%= r.username %></td>
            <td>$<%= Number(r.totalAmount || 0).toFixed(2) %></td>
            <td><%= r.payment_method || 'N/A' %></td>
            <td><%= r.reason %></td>
            <td><%= r.status %></td>
            <td>
              <% if (r.status === 'PENDING') { %>
                <form class="mb-2" method="POST" action="/admin/refunds/<%= r.id %>/approve">
                  <input class="form-control form-control-sm mb-1" name="admin_note" placeholder="Admin note (optional)" />
                  <button class="btn btn-sm btn-success" type="submit">Approve</button>
                </form>
                <form method="POST" action="/admin/refunds/<%= r.id %>/reject">
                  <input class="form-control form-control-sm mb-1" name="admin_note" placeholder="Admin note (optional)" />
                  <button class="btn btn-sm btn-danger" type="submit">Reject</button>
                </form>
              <% } else { %>
                <span class="text-muted">No actions</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</div>

</body>
</html>
